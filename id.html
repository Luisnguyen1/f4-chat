<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tìm User qua ID hoặc Tên (Firebase)</title>
</head>
<body>
  <h2>Tìm User</h2>
  <input type="text" id="searchValue" placeholder="Nhập ID hoặc Tên">
  <button onclick="findUser()">Tìm</button>
  
  <div id="result"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // Cấu hình Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCERsSDmnicIJ2HFGfSDSWR4dF89JsVt0g",
      authDomain: "minh-project-44548.firebaseapp.com",
      databaseURL: "https://minh-project-44548-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "minh-project-44548",
      storageBucket: "minh-project-44548.firebasestorage.app",
      messagingSenderId: "717104512164",
      appId: "1:717104512164:web:d43a26cb292ae153e57a31",
      measurementId: "G-GRKEN1PSPQ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function findUser() {
      const input = document.getElementById('searchValue').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "";

      if (!input) {
        resultDiv.innerHTML = "<p style='color:red'>Vui lòng nhập dữ liệu!</p>";
        return;
      }

      // Thử tìm theo ID trước
      db.ref('users/' + input).once('value')
        .then(snapshot => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            resultDiv.innerHTML = `
              <p><strong>ID:</strong> ${input}</p>
              <p><strong>Tên:</strong> ${data.name}</p>
              <p><strong>Email:</strong> ${data.email}</p>
            `;
          } else {
            // Nếu không tìm thấy ID → tìm theo tên
            db.ref('users')
              .orderByChild('name')
              .equalTo(input)
              .once('value')
              .then(nameSnap => {
                if (nameSnap.exists()) {
                  nameSnap.forEach(childSnap => {
                    const data = childSnap.val();
                    resultDiv.innerHTML += `
                      <p><strong>ID:</strong> ${childSnap.key}</p>
                      <p><strong>Tên:</strong> ${data.name}</p>
                      <p><strong>Email:</strong> ${data.email}</p>
                      <hr>
                    `;
                  });
                } else {
                  resultDiv.innerHTML = "<p style='color:red'>Không tìm thấy user!</p>";
                }
              });
          }
        })
        .catch(error => {
          console.error(error);
          resultDiv.innerHTML = "<p style='color:red'>Lỗi khi lấy dữ liệu!</p>";
        });
    }
  </script>
</body>
</html>
